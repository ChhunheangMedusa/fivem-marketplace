<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FiveM Store - Checkout</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      @media print {
        nav,
        button,
        #checkoutSection {
          display: none !important;
        }
        #orderConfirmationSection {
          display: block !important;
        }
      }

      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body class="bg-gray-900 text-white min-h-screen">
    <!-- Navigation -->
    <nav class="bg-gray-800 shadow-lg">
      <div class="container mx-auto px-4">
        <div class="flex justify-between items-center py-4">
          <div class="flex items-center">
            <h1 class="text-2xl font-bold text-blue-400">FiveM Store</h1>
          </div>
          <div class="hidden md:flex space-x-8">
            <a href="index.html" class="hover:text-blue-400 transition">Home</a>
            <a href="products.html" class="hover:text-blue-400 transition"
              >Products</a
            >
            <a href="categories.html" class="hover:text-blue-400 transition"
              >Categories</a
            >
            <a href="about.html" class="hover:text-blue-400 transition"
              >About</a
            >
          </div>
          <div class="flex items-center space-x-4">
            <div class="relative">
              <input
                type="text"
                placeholder="Search..."
                class="bg-gray-700 text-white px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 w-40 md:w-64"
              />
              <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
            </div>
            <a
              href="checkout.html"
              class="relative p-2 text-blue-400 transition"
            >
              <i class="fas fa-shopping-cart text-xl"></i>
              <span
                id="cartCount"
                class="absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center hidden"
                >0</span
              >
            </a>
            <button
              id="themeToggle"
              onclick="toggleTheme()"
              class="p-2 hover:text-blue-400 transition"
            >
              <i class="fas fa-moon"></i>
            </button>
          </div>
        </div>
        <div
          class="md:hidden flex justify-center space-x-6 py-3 border-t border-gray-700"
        >
          <a href="index.html" class="hover:text-blue-400 transition">Home</a>
          <a href="products.html" class="hover:text-blue-400 transition"
            >Products</a
          >
          <a href="categories.html" class="hover:text-blue-400 transition"
            >Categories</a
          >
          <a href="about.html" class="hover:text-blue-400 transition">About</a>
        </div>
      </div>
    </nav>

    <main class="container mx-auto px-4 py-8">
      <!-- Checkout Section -->
      <div id="checkoutSection">
        <h1 class="text-3xl font-bold mb-8">Checkout</h1>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <!-- Cart Items -->
          <div class="lg:col-span-2">
            <div id="cartItems" class="bg-gray-800 rounded-lg p-6">
              <!-- Cart items will be loaded here -->
            </div>
          </div>

          <!-- Order Summary -->
          <div class="lg:col-span-1">
            <div class="bg-gray-800 rounded-lg p-6 sticky top-4">
              <h3 class="text-xl font-semibold mb-4">Order Summary</h3>

              <div class="space-y-2 mb-4">
                <div class="flex justify-between">
                  <span>Subtotal:</span>
                  <span id="subtotal">$0.00</span>
                </div>
                <div class="flex justify-between">
                  <span>Tax:</span>
                  <span id="tax">$0.00</span>
                </div>
                <div
                  class="flex justify-between text-lg font-semibold border-t border-gray-700 pt-2"
                >
                  <span>Total:</span>
                  <span id="total">$0.00</span>
                </div>
              </div>

              <button
                id="checkoutButton"
                class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg transition font-semibold disabled:bg-gray-600 disabled:cursor-not-allowed"
              >
                Order via Telegram
              </button>

              <div id="freeDownloadSection" class="hidden mt-4">
                <button
                  onclick="processFreeCheckout()"
                  class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg transition font-semibold"
                >
                  Download All Free Products
                </button>
              </div>

              <!-- Order Preview -->
              <div
                id="orderPreview"
                class="hidden mt-4 p-4 bg-gray-700 rounded-lg"
              >
                <h4 class="font-semibold mb-2">📦 Order Includes:</h4>
                <div id="orderPreviewList" class="text-sm space-y-1">
                  <!-- Order preview will be loaded here -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Order Confirmation Section -->
      <div id="orderConfirmationSection" class="hidden fade-in">
        <div class="bg-gray-800 rounded-lg p-6 max-w-4xl mx-auto">
          <div class="text-center mb-8">
            <i class="fas fa-check-circle text-green-500 text-5xl mb-4"></i>
            <h1 class="text-3xl font-bold">Order Confirmed!</h1>
            <p class="text-gray-400 mt-2">
              Your order has been successfully placed
            </p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Order Details -->
            <div class="bg-gray-700 rounded-lg p-6">
              <h2 class="text-xl font-semibold mb-4">🧾 ORDER CONFIRMATION</h2>

              <div class="space-y-4">
                <div>
                  <p class="text-gray-400">Invoice No.</p>
                  <p class="font-semibold" id="invoiceNumber">INV-2025-001</p>
                </div>

                <div>
                  <p class="text-gray-400">Date Issued</p>
                  <p class="font-semibold" id="invoiceDate">October 18, 2025</p>
                </div>

                <div>
                  <p class="text-gray-400">Payment Status</p>
                  <p class="font-semibold text-yellow-400" id="paymentStatus">
                    Pending
                  </p>
                </div>

                <div>
                  <p class="text-gray-400">Client Name</p>
                  <p class="font-semibold" id="clientName">[Customer Name]</p>
                </div>
              </div>
            </div>

            <!-- Order Summary -->
            <div class="bg-gray-700 rounded-lg p-6">
              <h2 class="text-xl font-semibold mb-4">💰 ORDER SUMMARY</h2>

              <div class="space-y-2">
                <div class="flex justify-between">
                  <span>Total Items:</span>
                  <span id="confirmationItems">1</span>
                </div>
                <div class="flex justify-between">
                  <span>Subtotal:</span>
                  <span id="confirmationSubtotal">$10.00</span>
                </div>
                <div class="flex justify-between">
                  <span>Tax (10%):</span>
                  <span id="confirmationTax">$1.00</span>
                </div>
                <div
                  class="flex justify-between text-lg font-semibold border-t border-gray-600 pt-2"
                >
                  <span>Total Amount Due:</span>
                  <span id="confirmationTotal">$11.00</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Product Details -->
          <div class="bg-gray-700 rounded-lg p-6 mt-6">
            <h2 class="text-xl font-semibold mb-4">📦 PRODUCT DETAILS</h2>
            <div id="productDetailsList">
              <!-- Product details will be loaded here -->
            </div>
          </div>

          <!-- Payment & Delivery Process -->
          <div class="bg-gray-700 rounded-lg p-6 mt-6">
            <h2 class="text-xl font-semibold mb-4">
              🪙 PAYMENT & DELIVERY PROCESS
            </h2>
            <div class="space-y-3">
              <p>A QR code for payment will be provided shortly.</p>
              <p>Please complete the payment using the provided method.</p>
              <p>
                Once payment is confirmed, don't forget to send the invoice.
              </p>
              <p>
                You will then receive a torrent download link for your product.
              </p>
              <p>Download, install, and enjoy your new script.</p>
              <p class="mt-4">
                Thank you for your order and for choosing our services.
              </p>
            </div>
          </div>

          <!-- Telegram Integration -->
          <div class="bg-gray-700 rounded-lg p-6 mt-6">
            <h2 class="text-xl font-semibold mb-4">
              📱 TELEGRAM ORDER CONFIRMATION
            </h2>
            <div class="space-y-4">
              <p class="text-gray-300">
                Your order details are being sent to our Telegram bot
                automatically.
              </p>

              <div id="telegramStatus" class="flex items-center space-x-3">
                <div
                  id="telegramLoading"
                  class="flex items-center space-x-2 text-blue-400"
                >
                  <i class="fas fa-spinner fa-spin"></i>
                  <span>Sending order to Telegram...</span>
                </div>
                <div
                  id="telegramSuccess"
                  class="hidden items-center space-x-2 text-green-400"
                >
                  <i class="fas fa-check-circle"></i>
                  <span>Order sent to Telegram successfully!</span>
                </div>
                <div
                  id="telegramError"
                  class="hidden items-center space-x-2 text-red-400"
                >
                  <i class="fas fa-exclamation-circle"></i>
                  <span>Failed to send to Telegram. Please try manually.</span>
                </div>
              </div>

              <div
                id="telegramAutoRedirect"
                class="hidden bg-blue-900/30 border border-blue-700 rounded-lg p-4 mt-4"
              >
                <div class="flex items-center space-x-3">
                  <i class="fas fa-external-link-alt text-blue-400 text-xl"></i>
                  <div>
                    <p class="font-semibold">Opening Telegram...</p>
                    <p class="text-sm text-gray-300">
                      You will be redirected to Telegram automatically in
                      <span id="countdown">3</span> seconds
                    </p>
                  </div>
                </div>
              </div>

              <div class="flex flex-col sm:flex-row gap-4 mt-4">
                <button
                  id="openTelegramBtn"
                  class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg transition font-semibold flex items-center justify-center"
                >
                  <i class="fab fa-telegram mr-2"></i>
                  Open Telegram Now
                </button>
                <button
                  id="copyMessageBtn"
                  class="flex-1 bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg transition font-semibold flex items-center justify-center"
                >
                  <i class="fas fa-copy mr-2"></i>
                  Copy Order Details
                </button>
              </div>
            </div>
          </div>

          <!-- Actions -->
          <div class="flex flex-col sm:flex-row gap-4 mt-8">
            <button
              onclick="printInvoice()"
              class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg transition font-semibold flex items-center justify-center"
            >
              <i class="fas fa-print mr-2"></i>
              Print Invoice
            </button>
            <button
              onclick="continueShopping()"
              class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg transition font-semibold flex items-center justify-center"
            >
              <i class="fas fa-shopping-cart mr-2"></i>
              Continue Shopping
            </button>
          </div>
        </div>
      </div>
    </main>

    <script>
      // Telegram configuration
      const TELEGRAM_BOT_USERNAME = "heanghg799";
      let telegramUrl = "";
      let countdownInterval = null;

      // Cart management functions
      function getCart() {
        const cart = localStorage.getItem("cart");
        return cart ? JSON.parse(cart) : [];
      }

      function removeFromCart(productId) {
        let cart = getCart();
        cart = cart.filter((item) => item.id !== productId);
        localStorage.setItem("cart", JSON.stringify(cart));
        renderCart();
        updateCartCount();
      }

      function updateCartCount() {
        const cart = getCart();
        const cartCount = document.getElementById("cartCount");
        if (cartCount) {
          if (cart.length > 0) {
            cartCount.textContent = cart.length;
            cartCount.classList.remove("hidden");
          } else {
            cartCount.classList.add("hidden");
          }
        }
      }

      function showNotification(message, type = "success") {
        // Create notification element
        const notification = document.createElement("div");
        notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
          type === "error" ? "bg-red-600" : "bg-green-600"
        } text-white`;
        notification.textContent = message;

        // Add to page
        document.body.appendChild(notification);

        // Remove after 3 seconds
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 3000);
      }

      function renderCart() {
        const cart = getCart();
        const cartItems = document.getElementById("cartItems");
        const subtotalElement = document.getElementById("subtotal");
        const taxElement = document.getElementById("tax");
        const totalElement = document.getElementById("total");
        const checkoutButton = document.getElementById("checkoutButton");
        const freeDownloadSection = document.getElementById(
          "freeDownloadSection"
        );
        const orderPreview = document.getElementById("orderPreview");
        const orderPreviewList = document.getElementById("orderPreviewList");

        if (cart.length === 0) {
          cartItems.innerHTML = `
            <div class="text-center py-8">
              <i class="fas fa-shopping-cart text-4xl text-gray-400 mb-4"></i>
              <p class="text-gray-400">Your cart is empty</p>
              <a href="products.html" class="text-blue-400 hover:text-blue-300 mt-2 inline-block">
                Continue Shopping
              </a>
            </div>
          `;
          subtotalElement.textContent = "$0.00";
          taxElement.textContent = "$0.00";
          totalElement.textContent = "$0.00";
          checkoutButton.disabled = true;
          freeDownloadSection.classList.add("hidden");
          orderPreview.classList.add("hidden");
          return;
        }

        // Calculate totals
        const subtotal = cart.reduce(
          (sum, item) => sum + item.price * item.quantity,
          0
        );
        const tax = subtotal * 0.1;
        const total = subtotal + tax;

        // Update totals
        subtotalElement.textContent = `$${subtotal.toFixed(2)}`;
        taxElement.textContent = `$${tax.toFixed(2)}`;
        totalElement.textContent = `$${total.toFixed(2)}`;

        // Show/hide free download section
        const hasFreeProducts = cart.some((item) => item.price === 0);
        const hasPaidProducts = cart.some((item) => item.price > 0);

        if (hasFreeProducts && !hasPaidProducts) {
          freeDownloadSection.classList.remove("hidden");
          checkoutButton.disabled = true;
          orderPreview.classList.add("hidden");
        } else {
          freeDownloadSection.classList.add("hidden");
          checkoutButton.disabled = false;
          orderPreview.classList.remove("hidden");
        }

        // Render cart items
        cartItems.innerHTML = cart
          .map(
            (item) => `
              <div class="flex items-center justify-between py-4 border-b border-gray-700 last:border-b-0">
                <div class="flex items-center space-x-4">
                  <div class="w-16 h-16 bg-gray-700 rounded flex items-center justify-center">
                    ${
                      item.images && item.images.length > 0
                        ? `<img src="${item.images[0]}" alt="${item.title}" class="w-full h-full object-cover rounded" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                       <div class="w-full h-full flex items-center justify-center" style="display: none;">
                         <i class="fas fa-box text-gray-400"></i>
                       </div>`
                        : `<i class="fas fa-box text-gray-400"></i>`
                    }
                  </div>
                  <div class="flex-1">
                    <h4 class="font-semibold">${item.title}</h4>
                    <p class="text-gray-400 text-sm">${
                      item.shortDescription ||
                      item.description ||
                      "No description available"
                    }</p>
                    <div class="flex items-center space-x-2 mt-1">
                      <span class="text-green-400 font-semibold">
                        ${
                          item.price === 0
                            ? "FREE"
                            : `$${item.price.toFixed(2)}`
                        }
                      </span>
                      <span class="text-gray-400">× ${item.quantity}</span>
                    </div>
                    <div class="flex items-center space-x-2 mt-1 text-xs text-gray-400">
                      <span>🖼️ ${item.images?.length || 0} images</span>
                      <span>🔧 ${
                        item.categories?.join(", ") || "No categories"
                      }</span>
                    </div>
                    ${
                      item.torrentFile && item.price === 0
                        ? `
                    <div class="mt-2">
                      <button onclick="downloadProduct('${item.torrentFile}', '${item.title}')" 
                              class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition flex items-center">
                        <i class="fas fa-magnet mr-2"></i>
                        Download Torrent
                      </button>
                    </div>
                    `
                        : ""
                    }
                  </div>
                </div>
                <button onclick="removeFromCart(${item.id})" 
                        class="text-red-400 hover:text-red-300 transition ml-4">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            `
          )
          .join("");

        // Update order preview
        if (hasPaidProducts) {
          const paidItems = cart.filter((item) => item.price > 0);
          orderPreviewList.innerHTML = paidItems
            .map(
              (item) => `
            <div class="flex justify-between items-center py-1">
              <span class="truncate">${item.title}</span>
              <span class="text-green-400">$${item.price.toFixed(2)}</span>
            </div>
            <div class="text-xs text-gray-400 flex justify-between">
              <span>${item.images?.length || 0} images</span>
              <span>Qty: ${item.quantity}</span>
            </div>
          `
            )
            .join("");
        }
      }

      function downloadProduct(filePath, productName) {
        showNotification(`Starting torrent download: ${productName}`);
        const link = document.createElement("a");
        link.href = filePath;
        link.download = `${productName
          .replace(/\s+/g, "-")
          .toLowerCase()}.torrent`;
        link.target = "_blank";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        setTimeout(() => {
          showNotification(`${productName} torrent download started!`);
        }, 1000);
      }

      function processFreeCheckout() {
        const cart = getCart();
        const freeProducts = cart.filter((item) => item.price === 0);

        if (freeProducts.length === 0) {
          showNotification("No free products in cart", "error");
          return;
        }

        freeProducts.forEach((product) => {
          if (product.torrentFile) {
            downloadProduct(product.torrentFile, product.title);
          } else {
            showNotification(
              `No torrent file available for ${product.title}`,
              "error"
            );
          }
        });

        setTimeout(() => {
          freeProducts.forEach((item) => {
            removeFromCart(item.id);
          });
          showNotification("Free products downloaded successfully!");
        }, 2000);
      }

      function processCheckout() {
        const cart = getCart();
        const paidProducts = cart.filter((item) => item.price > 0);

        if (paidProducts.length === 0) {
          showNotification("No paid products in cart", "error");
          return;
        }

        // Show order confirmation
        showOrderConfirmation(paidProducts);

        // Send to Telegram automatically
        sendToTelegram(paidProducts);
      }

      function showOrderConfirmation(products) {
        // Hide checkout section, show confirmation section
        document.getElementById("checkoutSection").classList.add("hidden");
        document
          .getElementById("orderConfirmationSection")
          .classList.remove("hidden");

        // Calculate totals
        const subtotal = products.reduce(
          (sum, item) => sum + item.price * item.quantity,
          0
        );
        const tax = subtotal * 0.1;
        const total = subtotal + tax;

        // Update confirmation details
        document.getElementById("confirmationItems").textContent =
          products.length;
        document.getElementById(
          "confirmationSubtotal"
        ).textContent = `$${subtotal.toFixed(2)}`;
        document.getElementById(
          "confirmationTax"
        ).textContent = `$${tax.toFixed(2)}`;
        document.getElementById(
          "confirmationTotal"
        ).textContent = `$${total.toFixed(2)}`;

        // Generate product details from actual cart data
        const productDetailsList =
          document.getElementById("productDetailsList");
        productDetailsList.innerHTML = products
          .map(
            (product, index) => `
          <div class="mb-6 ${
            index < products.length - 1 ? "border-b border-gray-600 pb-4" : ""
          }">
            <div class="flex justify-between items-start mb-2">
              <h3 class="font-semibold">${product.title}</h3>
              <span class="text-green-400">$${product.price.toFixed(2)} × ${
              product.quantity
            } = $${(product.price * product.quantity).toFixed(2)}</span>
            </div>
            <p class="text-gray-400 mb-2">${
              product.description ||
              product.shortDescription ||
              "No description available"
            }</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
              <div><span class="text-gray-400">Categories:</span> ${
                product.categories?.join(", ") || "N/A"
              }</div>
              <div><span class="text-gray-400">Dependencies:</span> ${
                product.dependencies?.join(", ") || "None"
              }</div>
            </div>
            ${
              product.images && product.images.length > 0
                ? `
            <div class="mt-2">
              <span class="text-gray-400">Images:</span> ${product.images.length} screenshots available
            </div>
            `
                : ""
            }
          </div>
        `
          )
          .join("");

        // Generate invoice number with current date
        const now = new Date();
        const invoiceNumber = `INV-${now.getFullYear()}-${String(
          now.getMonth() + 1
        ).padStart(2, "0")}${String(now.getDate()).padStart(
          2,
          "0"
        )}-${Math.floor(Math.random() * 1000)
          .toString()
          .padStart(3, "0")}`;
        document.getElementById("invoiceNumber").textContent = invoiceNumber;

        // Format date
        const options = { year: "numeric", month: "long", day: "numeric" };
        document.getElementById("invoiceDate").textContent =
          now.toLocaleDateString("en-US", options);

        // Store order in localStorage for persistence
        storeOrder(products, invoiceNumber, total);
      }

      function storeOrder(products, invoiceNumber, total) {
        const orders = JSON.parse(localStorage.getItem("orders")) || [];
        const order = {
          id: invoiceNumber,
          products: products,
          total: total,
          date: new Date().toISOString(),
          status: "pending",
        };
        orders.push(order);
        localStorage.setItem("orders", JSON.stringify(orders));
      }

      function sendToTelegram(products) {
        // Show loading state
        document.getElementById("telegramLoading").classList.remove("hidden");
        document.getElementById("telegramSuccess").classList.add("hidden");
        document.getElementById("telegramError").classList.add("hidden");
        document.getElementById("telegramAutoRedirect").classList.add("hidden");

        // Create Telegram message
        const message = createTelegramMessage(products);

        // Encode message for URL
        const encodedMessage = encodeURIComponent(message);

        // Create Telegram URL
        telegramUrl = `https://t.me/${TELEGRAM_BOT_USERNAME}?text=${encodedMessage}`;

        // Set up Telegram button
        document.getElementById("openTelegramBtn").onclick = function () {
          clearInterval(countdownInterval);
          openTelegram();
        };

        // Set up copy button
        document.getElementById("copyMessageBtn").onclick = function () {
          navigator.clipboard.writeText(message).then(() => {
            showNotification("Order details copied to clipboard!");
          });
        };

        // Simulate sending to Telegram
        setTimeout(() => {
          document.getElementById("telegramLoading").classList.add("hidden");
          document.getElementById("telegramSuccess").classList.remove("hidden");
          showNotification("Order details sent to Telegram!");

          // Start auto-redirect countdown
          startAutoRedirect();
        }, 1500);
      }

      function startAutoRedirect() {
        document
          .getElementById("telegramAutoRedirect")
          .classList.remove("hidden");

        let countdown = 3;
        const countdownElement = document.getElementById("countdown");
        countdownElement.textContent = countdown;

        countdownInterval = setInterval(() => {
          countdown--;
          countdownElement.textContent = countdown;

          if (countdown <= 0) {
            clearInterval(countdownInterval);
            openTelegram();
          }
        }, 1000);
      }

      function openTelegram() {
        // Clear any existing countdown
        if (countdownInterval) {
          clearInterval(countdownInterval);
        }

        // Open Telegram in a new tab
        window.open(telegramUrl, "_blank");
        showNotification("Opening Telegram with your order details...");

        // Clear cart after successful order
        setTimeout(() => {
          localStorage.setItem("cart", JSON.stringify([]));
          updateCartCount();
        }, 1000);
      }

      function createTelegramMessage(products) {
        let message = `🛒 *ORDER REQUEST - ${products.length} PRODUCT(S)*\n\n`;

        let total = 0;

        products.forEach((product, index) => {
          const productTotal = product.price * product.quantity;
          total += productTotal;

          message += `*📦 PRODUCT ${index + 1}*\n`;
          message += `┌────────────────────────\n`;
          message += `│ 🏷️ *Title:* ${product.title}\n`;
          message += `│ 💰 *Price:* $${product.price.toFixed(2)} x ${
            product.quantity
          } = $${productTotal.toFixed(2)}\n`;
          message += `│ 📝 *Description:* ${
            product.description || product.shortDescription || "No description"
          }\n`;
          message += `│ 🔧 *Categories:* ${
            product.categories?.join(", ") || "N/A"
          }\n`;
          message += `│ ⚙️ *Dependencies:* ${
            product.dependencies?.join(", ") || "None"
          }\n`;
          message += `└────────────────────────\n\n`;
        });

        const tax = total * 0.1;
        const finalTotal = total + tax;

        message += `*💰 ORDER SUMMARY*\n`;
        message += `┌────────────────────────\n`;
        message += `│ 📦 Total Items: ${products.length}\n`;
        message += `│ 💵 Subtotal: $${total.toFixed(2)}\n`;
        message += `│ 🧾 Tax (10%): $${tax.toFixed(2)}\n`;
        message += `│ 💳 *TOTAL: $${finalTotal.toFixed(2)}*\n`;
        message += `└────────────────────────\n\n`;

        message += `*🔄 ORDER PROCESS:*\n`;
        message += `1. We will provide QR Code payment in shortly\n`;
        message += `2. Make payment\n`;
        message += `3. Provide Invoice of your payment\n`;
        message += `4. Provide link to download\n`;
        message += `5. You download and enjoy! 🎮\n\n`;

        return message;
      }

      function printInvoice() {
        window.print();
      }

      function continueShopping() {
        // Clear cart and redirect to products page
        localStorage.setItem("cart", JSON.stringify([]));
        window.location.href = "products.html";
      }

      function toggleTheme() {
        const currentTheme = document.documentElement.classList.contains("dark")
          ? "dark"
          : "light";
        const newTheme = currentTheme === "dark" ? "light" : "dark";
        document.documentElement.classList.remove("dark", "light");
        document.documentElement.classList.add(newTheme);
        localStorage.setItem("theme", newTheme);
        updateThemeToggleIcon(newTheme);
      }

      function updateThemeToggleIcon(theme) {
        const themeToggle = document.getElementById("themeToggle");
        if (themeToggle) {
          themeToggle.innerHTML =
            theme === "dark"
              ? '<i class="fas fa-sun"></i>'
              : '<i class="fas fa-moon"></i>';
        }
      }

      // Initialize
      document.addEventListener("DOMContentLoaded", () => {
        const savedTheme = localStorage.getItem("theme") || "dark";
        document.documentElement.className = savedTheme;
        updateThemeToggleIcon(savedTheme);

        renderCart();
        updateCartCount();

        document
          .getElementById("checkoutButton")
          .addEventListener("click", processCheckout);
      });
    </script>
  </body>
</html>
